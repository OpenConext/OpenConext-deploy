---
- name: Install bind packages
  ansible.builtin.package:
    name:
      - bind9
    state: present

- name: Create bind directories
  ansible.builtin.file:
    dest: "/var/cache/bind/{{ item }}"
    state: directory
    owner: bind
    group: bind
    mode: "750"
  with_items:
    - master
    - keys

- name: Configure bind options
  ansible.builtin.template:
    src: "{{ item }}.j2"
    dest: "/etc/bind/{{ item }}"
    owner: root
    group: bind
    mode: "0640"
  with_items: 
    - named.conf.options
    - named.conf.local
  notify:
    - "restart bind"

- name: Copy ha zone file
  ansible.builtin.template:
    src: "ha_zone_file.j2"
    dest: "/var/cache/bind/master/hb.{{ base_domain }}.db"
    owner: root
    group: bind
    mode: "0640"
  notify:
    - "reload bind"

- name: Enable bind service
  service:
    name: named
    state: started
    enabled: true
